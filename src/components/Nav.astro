---
import NavLink from './NavLink.astro';
import ThemeToggle from './ThemeToggle.astro';
import siteConfig from '../data/site-config';

const navLinks = siteConfig.headerNavLinks || [];
---

<nav class='min-h-10 pt-4 pb-12 relative sm:min-h-14 sm:pb-24 md:pt-8'>
    {
        navLinks.length > 0 && (
            <div class='w-full max-w-3xl mx-auto relative'>
                <button
                    class='menu-toggle w-8 h-8 -ml-1 flex items-center justify-center relative z-30 md:hidden'
                    aria-label='Open Menu'
                    aria-expanded='false'
                    aria-controls='menu-items'
                >
                    <span class='menu-toggle-icon w-6 h-px relative bg-current' />
                </button>
                <ul id='menu-items' class='menu flex gap-6'>
                    {navLinks.map((link) => (
                        <li class='py-1'>
                            <NavLink
                                class='text-xl font-serif text-main hover:underline hover:underline-offset-2 hover:decoration-1 md:text-base'
                                href={link.href}
                            >
                                {link.text}
                            </NavLink>
                        </li>
                    ))}
                </ul>
            </div>
        )
    }
    <section class='flex flex-row justify-center items-center gap-x-6'>
        <div class='absolute right-0 top-4 z-10 md:top-8'>
            <ThemeToggle />
        </div>
        <div class='absolute right-8 top-6 z-10 md:top-[2.5rem]'>
            <a href='/rss.xml' class='group'>
                <svg
                    version='1.0'
                    xmlns='http://www.w3.org/2000/svg'
                    width='15px'
                    height='15px'
                    viewBox='0 0 512.000000 512.000000'
                    preserveAspectRatio='xMidYMid meet'
                    class='text-zinc-950 dark:text-[#F2F1EB] group-hover:fill-zinc-900 dark:group-hover:fill-[#F2F1EB]'
                >
                    <g transform='translate(0.000000,512.000000) scale(0.100000,-0.100000)' fill='currentColor' stroke='none'>
                        <path
                            d='M49 5109 c-14 -5 -31 -21 -38 -35 -8 -18 -11 -175 -11 -540 l0 -515
23 -22 c21 -21 36 -24 232 -35 245 -14 393 -32 599 -73 1276 -257 2351 -1157
2836 -2374 162 -408 247 -804 269 -1263 11 -215 17 -237 73 -247 18 -3 260 -5
536 -3 l504 3 23 27 c23 26 23 32 19 160 -14 392 -57 723 -139 1064 -267 1112
-902 2091 -1821 2810 -138 108 -440 309 -606 403 -621 352 -1359 577 -2063
630 -216 16 -408 21 -436 10z'
                        ></path>
                        <path
                            d='M54 3440 c-55 -22 -54 -13 -54 -557 l0 -502 23 -26 c21 -25 27 -27
177 -35 316 -18 586 -89 866 -226 623 -304 1081 -898 1212 -1574 27 -136 32
-182 41 -340 6 -116 9 -133 29 -153 l23 -22 498 -3 c309 -1 508 1 524 7 52 20
56 39 46 229 -24 488 -139 923 -359 1363 -158 314 -362 593 -629 860 -287 285
-556 477 -923 654 -406 196 -804 298 -1269 325 -200 11 -178 11 -205 0z'
                        ></path>
                        <path
                            d='M631 1509 c-268 -47 -499 -244 -588 -500 -144 -414 95 -861 523 -980
100 -28 265 -30 369 -5 93 22 236 94 306 153 120 104 210 242 250 388 31 112
32 279 1 388 -77 271 -274 467 -547 544 -64 18 -244 25 -314 12z'
                        ></path>
                    </g>
                </svg>
            </a>
        </div>
    </section>
</nav>

<style>
    @media (max-width: 767px) {
        .menu {
            @apply flex-col gap-1 absolute -top-2.5 -left-2.5 max-w-64 px-3 pt-16 pb-10 z-20 bg-main border border-dashed border-main invisible opacity-0;
            width: calc(100% + 1.25rem);
        }
        .menu.is-visible {
            @apply visible opacity-100;
            transition: opacity 0.25s cubic-bezier(0.4, 0, 0.2, 1) 0.2s;
        }
        .menu-toggle-icon {
            transition: width 0.1s cubic-bezier(0.4, 0, 0.2, 1) 0.3s;
        }
        .menu-toggle.is-active .menu-toggle-icon {
            @apply w-0;
            transition: width 0.1s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .menu-toggle-icon:before,
        .menu-toggle-icon:after {
            @apply w-6 h-px absolute left-1/2 top-0 origin-center -translate-x-1/2 bg-current;
            content: '';
            transition:
                transform 0.2s cubic-bezier(0.4, 0, 0.2, 1),
                margin 0.2s cubic-bezier(0.4, 0, 0.2, 1) 0.2s;
        }
        .menu-toggle-icon:before {
            @apply -mt-1.5;
        }
        .menu-toggle-icon:after {
            @apply mt-1.5;
        }
        .menu-toggle.is-active .menu-toggle-icon:before,
        .menu-toggle.is-active .menu-toggle-icon:after {
            @apply mt-0;
            transition:
                margin 0.2s cubic-bezier(0.4, 0, 0.2, 1) 0.1s,
                transform 0.2s cubic-bezier(0.4, 0, 0.2, 1) 0.3s;
        }
        .menu-toggle.is-active .menu-toggle-icon:before {
            @apply rotate-45;
        }
        .menu-toggle.is-active .menu-toggle-icon:after {
            @apply -rotate-45;
        }
    }
</style>

<script>
    function menuToggle() {
        const menu = document.querySelector('.menu');
        const menuToggleBtn = document.querySelector('.menu-toggle');
        menuToggleBtn?.addEventListener('click', () => {
            const isMenuExpanded = menuToggleBtn.getAttribute('aria-expanded') === 'true';
            menuToggleBtn.classList.toggle('is-active');
            menuToggleBtn.setAttribute('aria-expanded', isMenuExpanded ? 'false' : 'true');
            menuToggleBtn.setAttribute('aria-label', isMenuExpanded ? 'Open Menu' : 'Close Menu');
            menu?.classList.toggle('is-visible');
        });
    }
    menuToggle();
    document.addEventListener('astro:after-swap', menuToggle);
</script>
